<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static/css/style.css" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <div class="center">
        <h1>TESTA I TUOI RIFLESSI</h1>
        <div id="liste">
            <div class="center">
                <ul class="regole" >
                    <li>
                        Questo è un test per verificare quanto i tuoi riflessi sono veloci.
                    </li>
                    <li>
                        Una volta premuto il pulsante partira il semaforo.
                    </li>
                    <li>
                        Quando diventera verde il semaforo dovrai premere sul pulsante. 
                    </li>
                    <li>Una volta premuto ti verrà detto il tuo tempo.</li>
                    <li>
                        Se lo premerai prima perderai direttamente
                    </li>
                </ul>
                <input type="button" value="Per Iniziare" class="bottone" id="inizio">
                <input type="button" value="REFLEX" class="bottone nascosto" id="start">
                <h3 id="tempo">Qui apparirà il tuo tempo</h3>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
        function generateRandomInteger(min, max) { //generatore di numeri
            let casualNumber = Math.random()
            casualNumber = casualNumber * (max-min+1)+min
            casualNumber = parseInt(casualNumber)
            return casualNumber
        }
        function delayed(index) {
            switch (index) {
                case 1: rosso1 = 255; break;
                case 2: rosso2 = 255; break;
                case 3: rosso3 = 255; break;
                case 4: rosso4 = 255; break;
                case 5: rosso5 = 255; break;
            }
        }
        function delayed2(){
            rosso1 = 0
            rosso2= 0
            rosso3= 0
            rosso4= 0
            rosso5= 0
            verde= 255
            startTime = Date.now()
            check=true
            tempoText.innerHTML="ORAAA!!!"
        }
        let inizio = document.querySelector("#inizio");
        let start = document.querySelector("#start");
        let tempoText = document.querySelector("#tempo");
        let check=false
        let startTime = null
        let rosso1 = 0
        let rosso2= 0
        let rosso3= 0
        let rosso4= 0
        let rosso5= 0
        let verde=0
        let timeOutid1=undefined
        let timeOutid2=undefined
        let timeOutid3=undefined
        let timeOutid4=undefined
        let timeOutid5=undefined
        let timeOutid6=undefined
        function reset(){
            rosso1 = 0
            rosso2= 0
            rosso3= 0
            rosso4  = 0
            rosso5 = 0
            verde  = 0
            check= false
            startTime = null;
            tempoText.textContent = "Qui apparirà il tuo tempo";
            clearTimeout(timeOutid1);
            clearTimeout(timeOutid2);
            clearTimeout(timeOutid3);
            clearTimeout(timeOutid4);
            clearTimeout(timeOutid5);
            clearTimeout(timeOutid6);
        }
        function setup(){
                let cnv = createCanvas(1000,500);
                angleMode(DEGREES);
                cnv.position(390, 400);
            }
            function draw(){
                fill(0,0,0)
                noStroke()
                rect(0,10,600,20)
                rect(0,0,100,240)
                rect(150,0,100,240)
                rect(300,0,100,240)
                rect(450,0,100,240)
                rect(600,0,100,240)

                stroke(255,255,255)
                strokeWeight(4)
                
                fill(0,verde,0)                
                circle(50,60,70)
                circle(200,60,70)                
                circle(350,60,70)                
                circle(500,60,70)                
                circle(650,60,70)

                fill(rosso1,0,0)
                circle(50,170,70)
                fill(rosso2,0,0)
                circle(200,170,70)
                fill(rosso3,0,0)
                circle(350,170,70)                
                fill(rosso4,0,0)
                circle(500,170,70)
                fill(rosso5,0,0)
                circle(650,170,70)
            }
        inizio.addEventListener("click", function (event) {
            reset()
            inizio.style.display = "none";
            start.style.display = "block";
            tempoText.innerHTML = "Preparati...";
            let random = generateRandomInteger(1,3)
            timeOutid1 = setTimeout(() => delayed(1), 1000);
            timeOutid2 = setTimeout(() => delayed(2), 2000);
            timeOutid3 = setTimeout(() => delayed(3), 3000);
            timeOutid4 = setTimeout(() => delayed(4), 4000);
            timeOutid5 = setTimeout(() => delayed(5), 5000);
            timeOutid6 = setTimeout(delayed2, 5000+random*1000);
        })
        start.addEventListener("click", function(event){
            if (!check) {
                tempoText.innerHTML = "Troppo presto! Hai perso.";
                reset()
            } else {
                let reactionTime = (Date.now() - startTime) / 1000;
                tempoText.innerHTML = "Il tuo tempo di reazione:" +reactionTime+" secondi";
            }
            start.value = "Riprova";
            inizio.style.display = "block";
            start.style.display = "none";
        })
            
    </script>
</body>
</html>
</body>
</html>